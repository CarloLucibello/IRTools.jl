<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reference · IRTools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>IRTools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../dynamo/">Dynamo</a></li><li class="current"><a class="toctext" href>Reference</a><ul class="internal"><li><a class="toctext" href="#Reflection-1">Reflection</a></li><li><a class="toctext" href="#IR-Manipulation-1">IR Manipulation</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Reference</a></li></ul><a class="edit-page" href="https://github.com/MikeInnes/IRTools.jl/blob/master/docs/src/reference.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Reference</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="API-Reference-1" href="#API-Reference-1">API Reference</a></h1><p>This page provides a comprehensive reference for IRTools functionality.</p><h2><a class="nav-anchor" id="Reflection-1" href="#Reflection-1">Reflection</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.@code_ir" href="#IRTools.@code_ir"><code>IRTools.@code_ir</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><pre><code class="language-julia">@code_ir f(args...)</code></pre><p>Convenience macro similar to <code>@code_lowered</code> or <code>@code_typed</code>. Retrieves the IR for the given function call.</p><pre><code class="language-none">julia&gt; @code_ir gcd(10, 5)
1: (%1, %2, %3)
  %4 = %2 == 0
  br 4 unless %4
2: ...</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/reflection/reflection.jl#L183-L194">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.meta" href="#IRTools.meta"><code>IRTools.meta</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">meta(Tuple{...})</code></pre><p>Construct metadata for a given method signature. Metadata can then be used to construct <a href="@ref"><code>IR</code></a> or used to perform other reflection on the method.</p><p>See also <a href="@ref"><code>@meta</code></a>, <a href="@ref"><code>typed_meta</code></a>.</p><pre><code class="language-none">julia&gt; IRTools.meta(Tuple{typeof(gcd),Int,Int})
Metadata for gcd(a::T, b::T) where T&lt;:Union{Int128, Int16, Int32, Int64, Int8, UInt128, UInt16, UInt32, UInt64, UInt8} in Base at intfuncs.jl:31</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/reflection/reflection.jl#L89-L99">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.typed_meta" href="#IRTools.typed_meta"><code>IRTools.typed_meta</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">typed_meta(Tuple{...})</code></pre><p>Same as <a href="@ref"><code>@meta</code></a>, but represents the method after type inference. IR constructed with typed metadata will have type annotations.</p><p>See also <a href="@ref"><code>@typed_meta</code></a>.</p><pre><code class="language-none">julia&gt; IRTools.typed_meta(Tuple{typeof(gcd),Int,Int})
Typed metadata for gcd(a::T, b::T) where T&lt;:Union{Int128, Int16, Int32, Int64, Int8, UInt128, UInt16, UInt32, UInt64, UInt8} in Base at intfuncs.jl:31</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/reflection/reflection.jl#L43-L53">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.@meta" href="#IRTools.@meta"><code>IRTools.@meta</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><pre><code class="language-julia">@meta f(args...)</code></pre><p>Convenience macro for retrieving metadata without writing a full type signature.</p><pre><code class="language-none">julia&gt; IRTools.@meta gcd(10, 5)
Metadata for gcd(a::T, b::T) where T&lt;:Union{Int128, Int16, Int32, Int64, Int8, UInt128, UInt16, UInt32, UInt64, UInt8} in Base at intfuncs.jl:31</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/reflection/reflection.jl#L144-L151">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.@typed_meta" href="#IRTools.@typed_meta"><code>IRTools.@typed_meta</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><pre><code class="language-julia">@typed_meta f(args...)</code></pre><p>Convenience macro for retrieving typed metadata without writing a full type signature.</p><pre><code class="language-none">julia&gt; IRTools.@typed_meta gcd(10, 5)
Typed metadata for gcd(a::T, b::T) where T&lt;:Union{Int128, Int16, Int32, Int64, Int8, UInt128, UInt16, UInt32, UInt64, UInt8} in Base at intfuncs.jl:31</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/reflection/reflection.jl#L158-L165">source</a></section><h2><a class="nav-anchor" id="IR-Manipulation-1" href="#IR-Manipulation-1">IR Manipulation</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.IR" href="#IRTools.IR"><code>IRTools.IR</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">IR()
IR(metadata; slots = false)</code></pre><p>Represents a fragment of SSA-form code.</p><p>IR can be constructed from scratch, but more usually an existing Julia method is used as a starting point (see <a href="@ref"><code>meta</code></a> for how to get metadata for a method). The <code>slots</code> argument determines whether the IR preserves mutable variable slots; by default, these are converted to SSA-style variables.</p><p>As a shortcut, IR can be constructed directly from a type signature, e.g.</p><pre><code class="language-none">julia&gt; IR(typeof(gcd), Int, Int)
1: (%1, %2, %3)
  %4 = %2 == 0
  br 4 unless %4
2: ...</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L86-L104">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.Statement" href="#IRTools.Statement"><code>IRTools.Statement</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Statement(expr; type, line)</code></pre><p>Represents a single statement in the IR. The <code>expr</code> is a non-nested Julia expression (<code>Expr</code>). <code>type</code> represents the return type of the statement; in most cases this can be ignored and defaults to <code>Any</code>. <code>line</code> represents the source location of the statement; it is an integer index into the IR&#39;s line table.</p><p>As a convenience, if <code>expr</code> is already a statement, the new statement will inherit its type and line number.</p></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L46-L56">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.Variable" href="#IRTools.Variable"><code>IRTools.Variable</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Variable(N)
var(N)</code></pre><p>Represents an SSA variable. Primarily used as an index into <code>IR</code> objects.</p></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L11-L16">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.argument!" href="#IRTools.argument!"><code>IRTools.argument!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">argument!(block, [value, type])</code></pre><p>Create a new argument for the given block / IR fragment, and return the variable representing the argument.</p><pre><code class="language-none">julia&gt; ir = IR();

julia&gt; argument!(ir)
%1

julia&gt; ir
1: (%1)</code></pre><p>The <code>at</code> keyword argument can be used to specify where the new argument should go; by default it is appended to the end of the argument list.</p><p>If there are branches to this block, they will be updated to pass <code>value</code> (<code>nothing</code> by default) as an argument.</p></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L206-L225">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.push!" href="#Base.push!"><code>Base.push!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">push!(ir, x)</code></pre><p>Append the statement or expression <code>x</code> to the IR or block <code>ir</code>, returning the new variable. See also <a href="#Base.pushfirst!"><code>pushfirst!</code></a>, <a href="#Base.insert!"><code>insert!</code></a>.</p><pre><code class="language-none">julia&gt; ir = IR();

julia&gt; x = argument!(ir)
%1

julia&gt; push!(ir, xcall(:*, x, x))
%2

julia&gt; ir
1: (%1)
  %2 = %1 * %1</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L400-L417">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.pushfirst!" href="#Base.pushfirst!"><code>Base.pushfirst!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">pushfirst!(ir, x)</code></pre><p>Insert the expression or statement <code>x</code> into the given IR or block at the beginning, returning the new variable. See also <a href="#Base.push!"><code>push!</code></a>, <a href="#Base.insert!"><code>insert!</code></a>.</p><pre><code class="language-none">julia&gt; f(x) = 3x + 2
f (generic function with 1 method)

julia&gt; ir = @code_ir f(1)
1: (%1, %2)
  %3 = 3 * %2
  %4 = %3 + 2
  return %4

julia&gt; pushfirst!(ir, :(println(&quot;hello, world&quot;)))
%5

julia&gt; ir
1: (%1, %2)
  %5 = println(&quot;hello, world&quot;)
  %3 = 3 * %2
  %4 = %3 + 2
  return %4</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L447-L472">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.insert!" href="#Base.insert!"><code>Base.insert!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">insert!(ir, v, x)</code></pre><p>Insert the expression or statement <code>x</code> into the given IR, just before the variable <code>v</code> is defined, returning the new variable for <code>x</code>. See also <a href="@ref"><code>insertafter!</code></a>.</p><pre><code class="language-none">julia&gt; f(x) = 3x + 2
f (generic function with 1 method)

julia&gt; ir = @code_ir f(1)
1: (%1, %2)
  %3 = 3 * %2
  %4 = %3 + 2
  return %4

julia&gt; insert!(ir, IRTools.var(4), :(println(&quot;hello, world&quot;)))
%5

julia&gt; ir
1: (%1, %2)
  %3 = 3 * %2
  %5 = println(&quot;hello, world&quot;)
  %4 = %3 + 2
  return %4</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L475-L500">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.insertafter!" href="#IRTools.insertafter!"><code>IRTools.insertafter!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">insertafter!(ir, v, x)</code></pre><p>Insert the expression or statement <code>x</code> into the given IR, just before the variable <code>v</code> is defined, returning the new variable for <code>x</code>. See also <a href="#Base.insert!"><code>insert!</code></a>.</p><pre><code class="language-none">julia&gt; f(x) = 3x + 2
f (generic function with 1 method)

julia&gt; ir = @code_ir f(1)
1: (%1, %2)
  %3 = 3 * %2
  %4 = %3 + 2
  return %4

julia&gt; IRTools.insertafter!(ir, IRTools.var(4), :(println(&quot;hello, world&quot;)))
%5

julia&gt; ir
1: (%1, %2)
  %3 = 3 * %2
  %4 = %3 + 2
  %5 = println(&quot;hello, world&quot;)
  return %4</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L510-L535">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.empty" href="#Base.empty"><code>Base.empty</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">empty(ir)</code></pre><p>Create an empty IR fragment based on the given IR. The line number table and any metadata are preserved from the original IR.</p><pre><code class="language-none">julia&gt; ir = empty(@code_ir gcd(10, 5))
1:

julia&gt; ir.meta
Metadata for gcd(a::T, b::T) where T&lt;:Union{Int128, Int16, Int32, Int64, Int8, UInt128, UInt16, UInt32, UInt64, UInt8} in Base at intfuncs.jl:31</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L538-L549">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.keys" href="#Base.keys"><code>Base.keys</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">keys(ir)</code></pre><p>Return the variable keys for all statements defined in <code>ir</code>.</p><pre><code class="language-none">julia&gt; f(x) = 3x + 2;

julia&gt; ir = @code_ir f(1)
1: (%1, %2)
  %3 = 3 * %2
  %4 = %3 + 2
  return %4

julia&gt; keys(ir)
2-element Array{IRTools.Variable,1}:
 %3
 %4</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L363-L380">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.haskey" href="#Base.haskey"><code>Base.haskey</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">haskey(ir, var)</code></pre><p>Check whether the variable <code>var</code> was defined in <code>ir</code>.</p><pre><code class="language-none">julia&gt; f(x) = 3x + 2;

julia&gt; ir = @code_ir f(1)
1: (%1, %2)
  %3 = 3 * %2
  %4 = %3 + 2
  return %4

julia&gt; haskey(ir, var(3))
true

julia&gt; haskey(ir, var(7))
false</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L285-L303">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.returnvalue" href="#IRTools.returnvalue"><code>IRTools.returnvalue</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">returnvalue(block)</code></pre><p>Retreive the return value of a block.</p><pre><code class="language-none">julia&gt; f(x) = 3x + 2;

julia&gt; IRTools.block(@code_ir(f(1)), 1)
1: (%1, %2)
  %3 = 3 * %2
  %4 = %3 + 2
  return %4

julia&gt; IRTools.returnvalue(ans)
%4</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L183-L198">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IRTools.Pipe" href="#IRTools.Pipe"><code>IRTools.Pipe</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Pipe(ir)</code></pre><p>In general, it is not efficient to insert statements into IR; only appending is fast, for the same reason as with <code>Vector</code>s.</p><p>For this reason, the <code>Pipe</code> construct makes it convenient to incrementally build an new IR fragment from an old one, making efficient modifications as you go.</p><p>The general pattern looks like:</p><pre><code class="language-none">pr = IRTools.Pipe(ir)
for (v, st) in pr
  # do stuff
end
ir = IRTools.finish(pr)</code></pre><p>Iterating over <code>pr</code> is just like iterating over <code>ir</code>, except that within the loop, inserting and deleting statements in <code>pr</code> around <code>v</code> is efficient. Later, <code>finish(pr)</code> converts it back to a normal IR fragment (in this case just a plain copy of the original).</p></div></div><a class="source-link" target="_blank" href="https://github.com/MikeInnes/IRTools.jl/blob/26676b63bafafc5c621a6b53f51825adc3d8d384/src/ir/ir.jl#L587-L608">source</a></section><footer><hr/><a class="previous" href="../dynamo/"><span class="direction">Previous</span><span class="title">Dynamo</span></a></footer></article></body></html>
